import{r as n,G as J,s as j,j as e}from"./app-CWG8IO2g.js";import{M as D,X as T,S as k}from"./index-CjEmi03Q.js";const E=()=>{const o=document.createElement("script");o.src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4",o.defer=!0,document.head.appendChild(o)},C="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let $=(o=21)=>{let i="",m=crypto.getRandomValues(new Uint8Array(o|=0));for(;o--;)i+=C[m[o]&63];return i};E();const L=()=>`${$()}__#${Date.now()}`;function z(o){let i;if(!isNaN(Number(o))&&Number(o)>1e12)i=new Date(Number(o));else if(typeof o=="string")i=new Date(o.replace(" ","T"));else throw new Error("Invalid datetime format");return i.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}function K(){const[o,i]=n.useState([]),[m,O]=n.useState(!1),[h,w]=n.useState(""),[u,b]=n.useState(""),[g,p]=n.useState([]),[I,v]=n.useState(!1),f=n.useRef(null),U=()=>{var s;(s=f==null?void 0:f.current)==null||s.scrollIntoView({behavior:"smooth"})},{post:y}=J({search:""});n.useEffect(()=>{U()},[g,I]);const S=()=>{if(!u.trim())return;let s;const t=localStorage.getItem("userMessageInfo");if(t){let r=JSON.parse(t);r.message_time||(r.message_time=Date.now().toString(),localStorage.setItem("userMessageInfo",JSON.stringify(r))),s=r}else{const r={customer_id:h,user_id:"",message_time:Date.now().toString()};localStorage.setItem("userMessageInfo",JSON.stringify(r)),s=r}if(s.user_id!=""){const r={customer_id:s.customer_id,user_id:s.user_id,message_time:Date.now(),role_type:"customer",message_seen:!0,message_type:"text",message:u,created_at:Date.now()};y(route("home.chat.send",r),{preserveScroll:!0}),p(a=>[...a,r]),b("")}else{const r={customer_id:s.customer_id,user_id:"",message_time:Date.now(),role_type:"customer",message_seen:!1,message_type:"text",message:u,created_at:Date.now()};y(route("home.store",r),{preserveScroll:!0}),p(a=>[...a,r]),b(""),g.length==0&&setTimeout(()=>{v(!0),setTimeout(()=>{v(!1);const a={customer_id:h,role_type:"adminUser",user_id:"",message_seen:!1,message_type:"text",message:"Thanks for your message! Our team will respond shortly.",message_time:Date.now(),created_at:Date.now()};p(l=>[...l,a])},2e3)},500)}},M=s=>{s.key==="Enter"&&S()};j("useridset","UserIdSetEvent",s=>{const{userId:t}=s,r=localStorage.getItem("userMessageInfo");if(r){let a=JSON.parse(r);a.user_id=t,localStorage.setItem("userMessageInfo",JSON.stringify(a))}}),j("message-send","MessageSendEvent",s=>{const{messageInfo:t}=s;if(t.role_type=="adminUser"&&(i(a=>{let l=a.find(d=>d.user_id==t.user_id),c=a;return l||(c=[...a,{user_id:t.user_id,user_name:t.user_name,user_photo:t.user_photo}]),c}),JSON.parse(localStorage.getItem("userMessageInfo")||"{}").customer_id==t.customer_id)){const a={customer_id:t.customer_id,user_id:t.user_id,message_time:t.message_time,role_type:"adminUser",message_seen:!0,message_type:t.message_type,message:t.message,created_at:t.created_at};p(l=>[...l,a])}});const N=()=>{O(!m);const r=localStorage.getItem("userMessageInfo"),a=r?JSON.parse(r):null;if(a)h||w(a.customer_id);else{const l=L();w(l)}};return n.useEffect(()=>{const s="userMessageInfo",t=localStorage.getItem(s);if(t){const a={...JSON.parse(t),message_time:"",user_id:""};localStorage.setItem(s,JSON.stringify(a))}},[]),n.useEffect(()=>{const s=sessionStorage.getItem("tabId")||`tab_${Date.now()}_${Math.random()}`;sessionStorage.getItem("tabId")||sessionStorage.setItem("tabId",s);const t=async c=>{try{const d=localStorage.getItem("userMessageInfo");if(d){let x=JSON.parse(d);const _={message:c==="tab"?"Tab closed":"Browser closed",timestamp:new Date().toISOString(),tabId:s,route:window.location.pathname,customer_id:x.customer_id};y(route("home.chat.close",_),{preserveScroll:!0})}}catch(d){console.error("Error sending close event:",d)}},r=c=>{sessionStorage.setItem("isClosing","true");const x=JSON.parse(localStorage.getItem("activeTabs")||"[]").filter(_=>_!==s);x.length>0?(t("tab"),localStorage.setItem("activeTabs",JSON.stringify(x))):(t("browser"),localStorage.removeItem("activeTabs"))},a=JSON.parse(localStorage.getItem("activeTabs")||"[]");a.includes(s)||(a.push(s),localStorage.setItem("activeTabs",JSON.stringify(a)));const l=setInterval(()=>{const c=JSON.parse(localStorage.getItem("activeTabs")||"[]");c.includes(s)||(c.push(s),localStorage.setItem("activeTabs",JSON.stringify(c)))},1e3);return window.addEventListener("beforeunload",r),()=>{window.removeEventListener("beforeunload",r),clearInterval(l)}},[]),e.jsxs("div",{className:"min-h-screen p-8 bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"mb-4 text-5xl font-bold text-center text-gray-800",children:"Live Support Chat Widget"}),e.jsx("p",{className:"mb-8 text-xl text-center text-gray-600",children:"Click the chat button in the bottom right to start a conversation"}),e.jsxs("div",{className:"p-8 mb-8 bg-white shadow-xl rounded-2xl",children:[e.jsx("h2",{className:"mb-6 text-2xl font-bold text-gray-800",children:"Features"}),e.jsx("ul",{className:"space-y-3",children:["Beautiful gradient design with smooth animations","Real-time message bubbles for user and support","Typing indicator for better UX","Fully responsive and mobile-friendly","Easy to customize and integrate"].map((s,t)=>e.jsxs("li",{className:"flex items-start gap-3 text-gray-700",children:[e.jsx("span",{className:"text-xl font-bold text-green-500",children:"âœ“"}),e.jsx("span",{children:s})]},t))})]})]}),e.jsxs("div",{className:"fixed z-50 bottom-6 right-6",children:[e.jsxs("div",{className:`mb-4 w-96 bg-white rounded-2xl shadow-2xl overflow-hidden transition-all duration-300 transform ${m?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-95 translate-y-4 pointer-events-none"}`,children:[e.jsx("div",{className:"p-4 text-white bg-gradient-to-r from-purple-600 to-pink-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white/20",children:e.jsx(D,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Live Support"}),e.jsx("p",{className:"text-xs text-white/80",children:"We typically reply in minutes"})]})]}),e.jsx("button",{onClick:N,className:"p-1 transition-colors rounded-full hover:bg-white/20",children:e.jsx(T,{size:20})})]})}),e.jsxs("div",{className:"p-4 overflow-y-auto h-96 bg-gray-50",children:[g.length!=0&&g.map((s,t)=>e.jsxs("div",{className:`flex gap-2 mb-4 ${s.role_type=="customer"?"flex-row-reverse":""}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 text-white font-semibold text-sm ${s.role_type=="adminUser"?"bg-gradient-to-br from-purple-500 to-pink-500":"bg-gradient-to-br from-blue-500 to-cyan-500"}`,children:s.role_type=="adminUser"?"S":"U"}),e.jsxs("div",{className:`flex flex-col ${s.role_type=="customer"?"items-end":"items-start"}`,children:[e.jsx("div",{className:`px-4 py-2 rounded-2xl max-w-xs ${s.role_type=="adminUser"?"bg-white text-gray-800 shadow-sm":"bg-gradient-to-r from-purple-600 to-pink-600 text-white"}`,children:s.message}),e.jsx("span",{className:"px-1 mt-1 text-xs text-gray-500",children:z(s.created_at)})]})]},t+1)),I&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("div",{className:"flex items-center justify-center flex-shrink-0 w-8 h-8 text-sm font-semibold text-white rounded-full bg-gradient-to-br from-purple-500 to-pink-500",children:"S"}),e.jsx("div",{className:"px-4 py-3 bg-white shadow-sm rounded-2xl",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]}),e.jsx("div",{ref:f})]}),e.jsx("div",{className:"p-4 bg-white border-t border-gray-100",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:u,onChange:s=>b(s.target.value),onKeyDown:M,placeholder:"Type your message...",className:"flex-1 px-4 py-2 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),e.jsx("button",{onClick:S,className:"p-2 text-white transition-all duration-200 rounded-xl bg-gradient-to-r from-purple-600 to-pink-600 hover:shadow-lg hover:scale-105 sendBtn",children:e.jsx(k,{size:16})})]})})]}),e.jsx("button",{onClick:N,className:"flex items-center justify-center text-white transition-all duration-300 shadow-2xl closeIcon rounded-xl bg-gradient-to-r from-purple-600 to-pink-600 w-14 h-14 hover:shadow-3xl hover:scale-110",children:m?e.jsx(T,{size:24}):e.jsx(D,{size:24})})]})]})}export{K as default};
